<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>float</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        canvas {
            border: 1px solid #f00;
        }
    </style>
</head>
<body>
    <canvas id="canvas" width="800" height="800"></canvas>
    
<script>

    let canvas = document.getElementById('canvas')
    let ctx = canvas.getContext('2d')

    let bigCupMaxWaterHeight = 160
    let bigCupWaterHeight = bigCupMaxWaterHeight

    function drawPt(pt) {
        ctx.fillStyle = '#000'
        ctx.beginPath()
        ctx.arc(pt.x, pt.y, 4, 0, Math.PI * 2)
        ctx.fill()
    }
    function drawSmallCup(smallCup) {
        ctx.beginPath()
        ctx.moveTo(smallCup.x, smallCup.y)
        ctx.lineTo(smallCup.x, smallCup.y + smallCup.height)
        ctx.lineTo(smallCup.x + smallCup.width, smallCup.y + smallCup.height)
        ctx.lineTo(smallCup.x + smallCup.width, smallCup.y)
        ctx.stroke()
    }
    function drawBigCup(smallCup) {
        ctx.beginPath()
        ctx.moveTo(smallCup.x, smallCup.y)
        ctx.lineTo(smallCup.x, smallCup.y + smallCup.height)
        ctx.lineTo(smallCup.x + smallCup.width, smallCup.y + smallCup.height)
        ctx.lineTo(smallCup.x + smallCup.width, smallCup.y + smallCup.height - bigCupMaxWaterHeight)
        ctx.lineTo(smallCup.x + smallCup.width + 20, smallCup.y + smallCup.height - bigCupMaxWaterHeight)
        ctx.stroke()
        ctx.moveTo(smallCup.x + smallCup.width + 20, smallCup.y + smallCup.height - bigCupMaxWaterHeight - 10)
        ctx.lineTo(smallCup.x + smallCup.width, smallCup.y + smallCup.height - bigCupMaxWaterHeight - 10)
        ctx.lineTo(smallCup.x + smallCup.width, smallCup.y)
        ctx.stroke()
    }

    let ropeLength = 70
    let objWidth = 40
    let groundY = 500
    let testor = {
            x: 308,
            y: 100,
            width: 100,
            height: 100
        }
    let hasOne = false
    let smallWaterHeight = 0
    let maxOffset = 0
    let maxV = 0

    function redraw() {

        ctx.clearRect(0, 0, 800, 800)

        
        ctx.beginPath()
        ctx.moveTo(0, groundY)
        ctx.lineTo(800, groundY)
        ctx.stroke()
    
        let bigCup = {
            x: 300,
            y: 300,
            width: 100,
            height: 200 
        }
        let smallCup = {
            x: 408,
            y: 400,
            width: 40,
            height: 100
        }
        // ctx.beginPath()
        // ctx.rect(bigCup.x, bigCup.y, bigCup.width, bigCup.height)
        // ctx.stroke()
        drawBigCup(bigCup)
        drawSmallCup(smallCup)
    
        
        ctx.beginPath()
        ctx.rect(testor.x, testor.y, testor.width, testor.height)
        ctx.stroke()
        
        let ropeStartPt = {
            x: testor.x + testor.width / 2,
            y: testor.y + testor.height,
        }
        let ropeEndPt = {
            x: testor.x + testor.width / 2,
            y: testor.y + testor.height + ropeLength,
        }
        ctx.beginPath()
        ctx.rect(testor.x, testor.y, testor.width, testor.height)
        ctx.stroke()
        // drawPt(ropeStartPt)
        // drawPt(ropeEndPt)
        ctx.beginPath()
        ctx.moveTo(ropeStartPt.x, ropeStartPt.y)
        ctx.lineTo(ropeEndPt.x, ropeEndPt.y)
        ctx.stroke()
        
    
        let bigCupWater = {
            x: bigCup.x,
            y: groundY - bigCupWaterHeight,
            width: bigCup.width,
            height: bigCupWaterHeight 
        }
        ctx.beginPath()
        ctx.rect(bigCupWater.x, bigCupWater.y, bigCupWater.width, bigCupWater.height)
        ctx.fillStyle = 'rgba(0, 153, 204, .2)'
        ctx.fill()
    
        

        let smallCupWater = {
            x: smallCup.x,
            y: groundY - smallWaterHeight,
            width: smallCup.width,
            height: smallWaterHeight 
        }
        ctx.beginPath()
        ctx.rect(smallCupWater.x, smallCupWater.y, smallCupWater.width, smallCupWater.height)
        ctx.fillStyle = 'rgba(0, 153, 204, .2)'
        ctx.fill()

        
        let obj = {
            x: ropeEndPt.x - objWidth / 2,
            y: ropeEndPt.y,
            width: objWidth,
            height: objWidth,
        }
        ctx.beginPath()
        ctx.rect(obj.x, obj.y, obj.width, obj.height)
        ctx.stroke()
        ctx.fillStyle = '#fff'
        ctx.fill()



        // let ropeEndPt = {
        //     x: testor.x + testor.width / 2,
        //     y: testor.y + testor.height + ropeLength,
        // }
        // ctx.beginPath()
        // ctx.rect(testor.x, testor.y, testor.width, testor.height)
        // ctx.stroke()
        // // drawPt(ropeStartPt)
        drawPt(ropeEndPt + objWidth)
    }


    
    // ropeLength = 120

    function update() {
        requestAnimationFrame(update)
        ropeLength += 0.1
        if (ropeLength > 200) {
            ropeLength = 200
        }

        
        // 

    //     let ropeLength = 70
    // let objWidth = 40
    // let groundY = 500
        redraw()

        let objDown = testor.y + testor.height + ropeLength + objWidth
        let asd = {
            x: testor.x + testor.width / 2,
            y: objDown
        }
        let waterTop = groundY - bigCupMaxWaterHeight
        // console.log('差距', waterTop - objDown)
        // if (waterTop - objDown < 0) {
        //     if (objDown - waterTop > maxOffset) {
        //         maxOffset = objDown - waterTop 
        //         console.log('maxOffset', maxOffset)
        //         maxV = maxOffset > objWidth ? objWidth : maxOffset
        //         smallWaterHeight = maxV * 0.6
        //     }
        // }
        let maxWaterHeight = bigCupMaxWaterHeight - 10
        let minWaterHeight = bigCupMaxWaterHeight - 40
        // if (waterTop - objDown >= 0) {
        //     bigCupWaterHeight = bigCupMaxWaterHeight - 20
        // } else {
        //     bigCupWaterHeight = bigCupMaxWaterHeight - 10
        // }
        let maxWaterY = groundY - maxWaterHeight
        let minWaterY = groundY - minWaterHeight
        
        if (objDown > maxWaterY) {
            let progress = ((objDown - waterTop) > 40 ? 40 : objDown - waterTop) / 40
            console.log('ooooook', progress)
            bigCupWaterHeight = maxWaterHeight + progress * 10
        } else {
            bigCupWaterHeight = maxWaterHeight
        }
        


        // bigCupWaterHeight = maxWaterHeight
        drawPt(asd)
    }
    update()

    let isDown = false
    canvas.addEventListener('mousedown', function (e) {
        isDown = true
        console.log(e.pageX)
        console.log(e.pageY)
        // let x = e.pageX
        // let y = e.pageY
        // startPt2 = {
        //     x,
        //     y
        // }
        // reDraw()
    })
    canvas.addEventListener('mousemove', function (e) {
        if (!isDown) {
            return
        }
        console.log(e.pageX)
        console.log(e.pageY)
        // let x = e.pageX
        // let y = e.pageY
        // startPt2 = {
        //     x,
        //     y
        // }
        // reDraw()
    })
    canvas.addEventListener('mouseup', function (e) {
        isDown = false
    })

    
</script>
</body>
</html>